<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'" />

    <title>Notifications</title>

    <link id="config_stylesheet" rel="stylesheet" />
    <style type="text/css">
      .has-addons .button {
        border-color: #444;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <section class="hero is-small has-background-grey-dark">
        <div class="hero-body">
          <p class="subtitle is-size-6 has-text-white-ter">Notifications usable via scripts (such as Multi Actions).</p>
        </div>
      </section>

      <div class="m-5">
        <div class="columns is-horizontal is-narrow mt-2 mb-5">
          <div class="column mt-2">
            <label class="label">Screen to notify:</label>
          </div>
          <div class="column has-text-right">
            <div class="is-inline-block screen">
              <div class="buttons has-addons"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      let _config = {};

      function update_buttons() {
        const buttons = document.querySelectorAll('.screen .buttons .button');
        for (let i = 0; i < buttons.length; ++i) {
          buttons[i].classList.toggle('is-selected', (i == _config.settings.screen));
        }
      }

      window.addEventListener('message', event => {
        if (event.origin !== 'null') {
          if (event.data.name == 'config') {
            _config = event.data.data;
            update_buttons();
          } else if (event.data.name == 'screens') {
            const buttons = document.querySelector('.screen .buttons');
            buttons.innerHTML = '';

            for (let i = 0; i < event.data.data; ++i) {
              const button = document.createElement('button');
              button.innerText = (i + 1).toString();

              button.classList.add('button');
              if (i == _config.settings.screen) {
                button.classList.add('is-selected');
              }

              button.addEventListener('click', event => {
                _config.settings.screen = Array.prototype.indexOf.call(buttons.children, button);
                update_buttons();

                event.target.blur();
                window.parent.postMessage({screen: _config.settings.screen}, '*');
              });

              buttons.appendChild(button);
            }
          }
        }
      }, false);
    </script>
  </body>

</html>
