<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'" />

		<title>StreamFlash</title>

		<link rel="stylesheet" href="../../public/css/config.css" />
		<style type="text/css">
			.has-addons .button {
				border-color: #444;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<section class="hero is-small has-background-grey-dark">
				<div class="hero-body">
					<p class="subtitle is-size-6 has-text-white-ter">Links to Twitch chat for scripts that need this feature.</p>
				</div>
			</section>

			<div class="m-5">
				<div class="field is-horizontal is-narrow mt-2 mb-5 p-2">
					<div class="field-label is-normal">
						<label class="label">Channel:</label>
					</div>
					<div class="field-body">
						<div class="field channel">
							<div class="control ml-6 pl-6">
								<input class="input has-text-centered" type="text" />
							</div>
						</div>
					</div>
				</div>

				<div class="field is-horizontal is-narrow mt-2 mb-5 p-2">
					<div class="field-label is-normal">
						<label class="label">Token:</label>
					</div>
					<div class="field-body">
						<div class="field has-addons token">
							<div class="control ml-6 pl-6 is-expanded">
								<input class="input has-text-centered is-two-thirds" type="text" />
							</div>
							<div class="control">
								<a class="button is-dark" external-link="http://twitchapps.com/tmi/">
									Generate
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			for (const name of ['channel', 'token'])
			{
				const elem = document.querySelector(`.${name} input`);
				const callback = event => {
					let data = {};
					data[name] = elem.value;

					window.parent.postMessage(data, '*');
				};

				elem.addEventListener('input', callback);
			}

			window.addEventListener('message', event => {
				if (event.origin !== 'null')
				{
					if (event.data.name == 'config')
					{
						console.log('addon receive config:', event.data.data);
						const _config = event.data.data;

						for (const name of ['channel', 'token'])
							document.querySelector(`.${name} input`).value = _config.connection[name];
					}
				}
			}, false);
		</script>
	</body>

</html>
